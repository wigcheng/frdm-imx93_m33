/*
 * Copyright 2024
 * Wig Cheng <onlywig@gmail.com>
 * All rights reserved.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

#include "fsl_device_registers.h"
#include "fsl_debug_console.h"
#include "fsl_lpspi.h"
#include "fsl_rgpio.h"
#include "board.h"
#include "app.h"

/*******************************************************************************
 * Definitions
 ******************************************************************************/
#define TRANSFER_SIZE     1U     /*! Transfer dataSize */
#define IMAGE_WIDTH	  250
#define IMAGE_HEIGHT	  32
#define IMAGE_SIZE	  (IMAGE_WIDTH * IMAGE_HEIGHT)

#define TRANSFER_BAUDRATE 500000U /*! Transfer baudrate - 500k */

/*******************************************************************************
 * Variables
 ******************************************************************************/
uint8_t masterTxData[TRANSFER_SIZE] = {0U};
uint8_t imageRawData[IMAGE_SIZE];
volatile uint32_t g_systickCounter  = 20U;

static uint32_t img_hex[122][16] = {
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x05555555, 0x554016aa, 0x94000000, 0x6aaa5005, 0x55500000, 0x00555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x55555555, 0x554006aa, 0xa4000001, 0x6aaa4005, 0x55500000, 0x01555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000001, 0x55555555, 0x554005aa, 0xa5000001, 0xaaa90005, 0x55500000, 0x01555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000005, 0x55555555, 0x554001aa, 0xa9000005, 0xaaa50005, 0x55500000, 0x05555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000015, 0x55555555, 0x5540006a, 0xaa400006, 0xaaa40005, 0x55500000, 0x05555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55555555, 0x5540005a, 0xaa50001a, 0xaa940005, 0x55500000, 0x15555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55555555, 0x5540001a, 0xaa90005a, 0xaa500005, 0x55500000, 0x15555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55500055, 0x55400016, 0xaa94006a, 0xaa400005, 0x55500000, 0x55555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55400055, 0x55400005, 0xaaa4016a, 0xa9400005, 0x55500001, 0x55555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000155, 0x55000055, 0x55400001, 0xaaa501aa, 0xa5000005, 0x55500001, 0x55555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000155, 0x55000055, 0x55400001, 0x6aa906aa, 0xa4000005, 0x55500005, 0x55555554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000155, 0x55000055, 0x55400000, 0x6aaa56aa, 0x94000005, 0x55500005, 0x55545554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000155, 0x55000055, 0x55400000, 0x1aaa5aaa, 0x90000005, 0x55500015, 0x55545554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55000055, 0x55400000, 0x16aaaaaa, 0x40000005, 0x55500055, 0x55515554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55400055, 0x55400000, 0x06aaaaa9, 0x40000005, 0x55500055, 0x55415554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55500055, 0x55400000, 0x05aaaaa9, 0x00000005, 0x55500155, 0x55415554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55555455, 0x55400000, 0x016aaaa5, 0x00000005, 0x55500155, 0x55015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000015, 0x55555555, 0x55400000, 0x006aaaa4, 0x00000005, 0x55500555, 0x55015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000015, 0x55555555, 0x55400000, 0x006aaaa5, 0x00000005, 0x55500555, 0x54015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000005, 0x55555555, 0x55400000, 0x01aaaaa9, 0x00000005, 0x55501555, 0x54015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000001, 0x55555555, 0x55400000, 0x05aaaaa9, 0x40000005, 0x55505555, 0x50015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x55555555, 0x55400000, 0x06aaaaaa, 0x40000005, 0x55505555, 0x40015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x01555555, 0x55400000, 0x1aaa9aaa, 0x90000005, 0x55515555, 0x40015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00001555, 0x55400000, 0x5aaa56aa, 0x94000005, 0x55515555, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55400000, 0x6aaa45aa, 0xa4000005, 0x55555555, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55400001, 0xaaa901aa, 0xa9000005, 0x55555554, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55400005, 0xaaa5016a, 0xa9400005, 0x55555554, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55400006, 0xaaa4006a, 0xaa400005, 0x55555550, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x5540001a, 0xaa94001a, 0xaa500005, 0x55555540, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x5540005a, 0xaa900016, 0xaa940005, 0x55555540, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x5540006a, 0xaa400006, 0xaaa40005, 0x55555500, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x554001aa, 0xa9400005, 0xaaa50005, 0x55555500, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x554005aa, 0xa9000001, 0x6aa94005, 0x55555400, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x554006aa, 0xa5000000, 0x6aaa4005, 0x55555400, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55401aaa, 0x94000000, 0x5aaa5005, 0x55555000, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000055, 0x55405aaa, 0x90000000, 0x1aaa9005, 0x55554000, 0x00015554, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffd55555, 0xfffff555, 0x57ff5557, 0xffff5557, 0xf5555fff, 0xffd5557f, 0xd555557f, 0xffffff55, 0x55fffffd, 0x5557ffff, 0xfd555555, 0x7ffff555, 0x5555ff55, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xfd555555, 0x5fff5555, 0x557f5557, 0xfffd555f, 0xf5555fff, 0xffd5557f, 0xd555557f, 0xffffff55, 0x55fffffd, 0x5557ffff, 0xd5555555, 0x7fffd555, 0x5555ff55, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5555555, 0x57fd5555, 0x557fd555, 0xfffd555f, 0xf55557ff, 0xff55557f, 0xd555557f, 0xffffff55, 0x557ffff5, 0x5557ffff, 0x55555555, 0x7fff5555, 0x5555ff55, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5555555, 0x57fd5555, 0x555ff555, 0x7ff5557f, 0xf55557ff, 0xff55557f, 0xd555557f, 0xffffff55, 0x557ffff5, 0x5557fffd, 0x55555555, 0x7ffd5555, 0x5555ff55, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5555555, 0x5ff55555, 0x5557f555, 0x7fd555ff, 0xf55557ff, 0xff55557f, 0xf55555ff, 0xffffff55, 0x557ffff5, 0x5557fff5, 0x55555555, 0x7ffd5555, 0x5555ff55, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5557ff5, 0x7ff5557f, 0x5557fd55, 0x5fd555ff, 0xf55555ff, 0xfd55557f, 0xff555fff, 0xffffff55, 0x555fffd5, 0x5557ffd5, 0x555ffd55, 0x7ff5555f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf555ffff, 0xffd555ff, 0xd557fd55, 0x5f5557ff, 0xf55555ff, 0xfd55557f, 0xff555fff, 0xffffff55, 0x555fffd5, 0x5557ffd5, 0x55fffd55, 0x7ff5557f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf555ffff, 0xffd557ff, 0xd557ff55, 0x575557ff, 0xf55555ff, 0xfd55557f, 0xff555fff, 0xffffff55, 0x555fffd5, 0x5557ff55, 0x57fffd55, 0x7ff5557f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5557fff, 0xffd557ff, 0xd557ffd5, 0x55555fff, 0xf555557f, 0xfd55557f, 0xff555fff, 0xffffff55, 0x5557ffd5, 0x5557ff55, 0x57fffd55, 0x7ff5557f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xfd55557f, 0xffd557ff, 0xd557ffd5, 0x55557fff, 0xf557557f, 0xf555557f, 0xff555fff, 0xffffff55, 0x7557ff55, 0x5557ff55, 0x57fffd55, 0x7ff5557f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xff555557, 0xffd555ff, 0xd557fff5, 0x55557fff, 0xf555557f, 0xf555557f, 0xff555fff, 0xffffff55, 0x5557ff55, 0x5557ff55, 0x5ffffd55, 0x7ff5555f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xffd55557, 0xffd5557f, 0x5557fff5, 0x5555ffff, 0xf555555f, 0xf557557f, 0xff555fff, 0xffffff55, 0x5555ff55, 0x7557ff55, 0x5ffffd55, 0x7ffd5555, 0x5555ffd5, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xff555557, 0xffd55555, 0x5557fffd, 0x5555ffff, 0xf555555f, 0xd557557f, 0xff555fff, 0xffffff55, 0x5555fd55, 0x7557ff55, 0x5ffffd55, 0x7ffd5555, 0x5555ffd5, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5555557, 0xffd55555, 0x5557fffd, 0x5555ffff, 0xf555d55f, 0xd557557f, 0xff555fff, 0xffffff55, 0x5d55fd55, 0x7557ff55, 0x5ffffd55, 0x7fff5555, 0x5555ffd5, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5555557, 0xffd55555, 0x555ffff5, 0x55557fff, 0xf555d557, 0xd55f557f, 0xff555ff5, 0x5555ff55, 0x5d557d55, 0xf557ff55, 0x5ffffd55, 0x7ffff555, 0x5555ffd5, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd5557fff, 0xffd55555, 0x557ffff5, 0x55557fff, 0xf555d557, 0x555f557f, 0xff555ff5, 0x5555ff55, 0x5d557555, 0xf557ff55, 0x5ffffd55, 0x7ffff555, 0x5555ffd5, 0x555557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd555ffff, 0xffd55755, 0x55ffffd5, 0x55555fff, 0xf555f557, 0x555f557f, 0xff555ff5, 0x5555ff55, 0x5f557555, 0xf557ff55, 0x57fffd55, 0x7fffd555, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd557ffff, 0xffd557ff, 0xffffff55, 0x55555fff, 0xf555f557, 0x557f557f, 0xff555ff5, 0x5555ff55, 0x5f557557, 0xf557ff55, 0x57fffd55, 0x7fffd555, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd555ffff, 0xfff555ff, 0xffffff55, 0x575557ff, 0xf555f555, 0x557f557f, 0xff555ff5, 0x5555ff55, 0x5f555557, 0xf557ff55, 0x55fffd55, 0x7fff5557, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd555ffff, 0xfff5557f, 0xfffffd55, 0x5fd555ff, 0xf555fd55, 0x557f557f, 0xff555fff, 0xffffff55, 0x5fd55557, 0xf557ffd5, 0x557ffd55, 0x7ffd555f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd5557fff, 0x57f5555f, 0xfffff555, 0x5fd555ff, 0xf555fd55, 0x557f557f, 0xff555fff, 0xffffff55, 0x5fd55557, 0xf557ffd5, 0x555ffd55, 0x7ffd555f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xd5555555, 0x57fd5555, 0x555ff555, 0x7ff5557f, 0xf555fd55, 0x55ff557f, 0xfd5557ff, 0xffffff55, 0x5fd5555f, 0xf557fff5, 0x55555555, 0x7ff5557f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xf5555555, 0x57ff5555, 0x555fd555, 0x7ffd555f, 0xf555ff55, 0x55ff557f, 0xd555557f, 0xffffff55, 0x5ff5555f, 0xf557fffd, 0x55555555, 0x7fd5557f, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xfd555555, 0x57ffd555, 0x555fd555, 0xfffd555f, 0xf555ff55, 0x55ff557f, 0xd555557f, 0xffffff55, 0x5ff5555f, 0xf557ffff, 0x55555555, 0x7fd555ff, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xff555555, 0x57fff555, 0x555f5557, 0xffff5557, 0xf555ff55, 0x57ff557f, 0xd555557f, 0xffffff55, 0x5ff5557f, 0xf557ffff, 0xd5555555, 0x7f5557ff, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xffd55555, 0x5fffff55, 0x555d5557, 0xffff5557, 0xf555ffd5, 0x57ff557f, 0xd555557f, 0xffffff55, 0x5ffd557f, 0xf557ffff, 0xfd555555, 0x7d5557ff, 0xf555ffff, 0xffd557ff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x0000ffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xfc000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
    {0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, }, 
};

/*******************************************************************************
 * Prototypes
 ******************************************************************************/

/*******************************************************************************
 * Code
 ******************************************************************************/
void SysTick_Handler(void)
{
    if (g_systickCounter != 0U)
    {
        g_systickCounter--;
    }
}

void Delay_ms(uint32_t ms)
{
    SDK_DelayAtLeastUs(1000U * ms, SystemCoreClock);
}

void spi_write(uint8_t *data, int len) {
    uint32_t srcClock_Hz;
    lpspi_master_config_t masterConfig;
    lpspi_transfer_t masterXfer;

    LPSPI_MasterGetDefaultConfig(&masterConfig);
    masterConfig.baudRate = TRANSFER_BAUDRATE;
    masterConfig.whichPcs = EXAMPLE_LPSPI_MASTER_PCS_FOR_INIT;
    masterConfig.pcsToSckDelayInNanoSec        = 1000000000U / (masterConfig.baudRate * 2U);
    masterConfig.lastSckToPcsDelayInNanoSec    = 1000000000U / (masterConfig.baudRate * 2U);
    masterConfig.betweenTransferDelayInNanoSec = 1000000000U / (masterConfig.baudRate * 2U);

    srcClock_Hz = LPSPI_MASTER_CLK_FREQ;
    LPSPI_MasterInit(EXAMPLE_LPSPI_MASTER_BASEADDR, &masterConfig, srcClock_Hz);

    masterXfer.txData   = data;
    masterXfer.rxData   = NULL;
    masterXfer.dataSize = len;
    masterXfer.configFlags = EXAMPLE_LPSPI_MASTER_PCS_FOR_TRANSFER | kLPSPI_MasterPcsContinuous;

    LPSPI_MasterTransferBlocking(EXAMPLE_LPSPI_MASTER_BASEADDR, &masterXfer);

    if (SysTick_Config(SystemCoreClock / 1000U))
    {
        while (1)
        {
        }
    }

    Delay_ms(20U);
}

void epd_writeCommand(uint8_t command){
    RGPIO_PortClear(BOARD_DC_RGPIO, 1u << BOARD_DC_RGPIO_PIN);
    Delay_ms(1U);
    spi_write(&command, 1);
}

void epd_writeData(uint8_t data){
    RGPIO_PortSet(BOARD_DC_RGPIO, 1u << BOARD_DC_RGPIO_PIN);
    Delay_ms(1U);
    spi_write(&data, 1);

}
void epd_HWreset(){
    RGPIO_PortSet(BOARD_RST_RGPIO, 1u << BOARD_RST_RGPIO_PIN);
    Delay_ms(50U);
    RGPIO_PortClear(BOARD_RST_RGPIO, 1u << BOARD_RST_RGPIO_PIN);
    Delay_ms(50U);
    RGPIO_PortSet(BOARD_RST_RGPIO, 1u << BOARD_RST_RGPIO_PIN);
    Delay_ms(50U);
}

void epd_waitUntilIdle(){
    Delay_ms(2U);
    while(true)
    {
        if(RGPIO_PinRead(BOARD_BUSY_RGPIO, BOARD_BUSY_RGPIO_PIN) == 1U)
        {
            break;
        }
    }
}

uint8_t img_fetch_hex_32(int y, int x, uint32_t* img_src){
    int hsize = 250/16 + (250%16==0 ? 0 : 1);
    if(y >=122 || x>=250){
        return 0b11;
    }
    else{
        uint32_t target = *(img_src+hsize*y + (int)(x/16));
        return (target)>>((15 - x%16)*2) & 0b11;
    }
}

int main(void)
{
    BOARD_InitHardware();

    uint32_t i, j;
    uint8_t ty;

    /* Control Pin initialization */
    rgpio_pin_config_t output_config = {
        kRGPIO_DigitalOutput,
        0,
    };
    rgpio_pin_config_t input_config = {
        kRGPIO_DigitalInput,
        0,
    };

    RGPIO_PinInit(BOARD_DC_RGPIO, BOARD_DC_RGPIO_PIN, &output_config);
    RGPIO_PinInit(BOARD_RST_RGPIO, BOARD_RST_RGPIO_PIN, &output_config);
    RGPIO_PinInit(BOARD_BUSY_RGPIO, BOARD_BUSY_RGPIO_PIN, &input_config);

    while(1){

        /* EPD Init */
        PRINTF("\r\n start\r\n");
        epd_HWreset();
        Delay_ms(1000U);
        epd_waitUntilIdle();
        PRINTF("\r\n reset successed\r\n");

        epd_writeCommand(0x4D);
        epd_writeData(0x78);
        epd_waitUntilIdle();

        epd_writeCommand(0x00); //PSR
        epd_writeData(0b00001111);
        epd_writeData(0b00001001);
        epd_waitUntilIdle();

        epd_writeCommand(0x01); //PWRR
        epd_writeData(0x07);
        epd_writeData(0x00);
        epd_writeData(0x22);
        epd_writeData(0x78);
        epd_writeData(0x0A);
        epd_writeData(0x22);
        epd_waitUntilIdle();

        epd_writeCommand(0x03); //POFS
        epd_writeData(0x10);
        epd_writeData(0x54);
        epd_writeData(0x44);
        epd_waitUntilIdle();

        epd_writeCommand(0x06); //BTST_P
        epd_writeData(0x0F);
        epd_writeData(0x0A);
        epd_writeData(0x2F);
        epd_writeData(0x25);
        epd_writeData(0x22);
        epd_writeData(0x2E);
        epd_writeData(0x21);
        epd_waitUntilIdle();

        epd_writeCommand(0x30); //CDI
        epd_writeData(0x02);
        epd_waitUntilIdle();

        epd_writeCommand(0x41);
        epd_writeData(0x00);
        epd_waitUntilIdle();

        epd_writeCommand(0x50);
        epd_writeData(0x37);
        epd_waitUntilIdle();

        epd_writeCommand(0x60);
        epd_writeData(0x02);
        epd_writeData(0x02);
        epd_waitUntilIdle();

        epd_writeCommand(0x61);
        epd_writeData(0x00);   // Source_BITS_H
        epd_writeData(0x80);   // Source_BITS_L
        epd_writeData(0x00);   // Gate_BITS_H
        epd_writeData(0xFA);
        epd_waitUntilIdle();

        epd_writeCommand(0x65);
        epd_writeData(0x00);
        epd_writeData(0x00);
        epd_writeData(0x00);
        epd_writeData(0x00);
        epd_waitUntilIdle();

        epd_writeCommand(0xE7);
        epd_writeData(0x1C);
        epd_waitUntilIdle();

        epd_writeCommand(0xE3);
        epd_writeData(0x22);
        epd_waitUntilIdle();

        epd_writeCommand(0xE0);
        epd_writeData(0x00);
        epd_waitUntilIdle();

        epd_writeCommand(0xB4);
        epd_writeData(0xD0);
        epd_waitUntilIdle();

        epd_writeCommand(0xB5);
        epd_writeData(0x03);
        epd_waitUntilIdle();

        epd_writeCommand(0xE9);
        epd_writeData(0x01);
        epd_waitUntilIdle();

        epd_writeCommand(0x10);
        Delay_ms(10);

        for(i = 0; i < 250; i++)
        {
            for(j = 0; j < 32; j++)
            {
                ty = (img_fetch_hex_32(j*4+0,i, img_hex)<<6) | (img_fetch_hex_32(j*4+1,i, img_hex)<<4) | (img_fetch_hex_32(j*4+2,i, img_hex)<<2) | (img_fetch_hex_32(j*4+3,i, img_hex)<<0);
                imageRawData[(i * 32) + j] = ty;
            }
        }

        RGPIO_PortSet(BOARD_DC_RGPIO, 1u << BOARD_DC_RGPIO_PIN);
        spi_write(&imageRawData[0], IMAGE_SIZE);
        Delay_ms(50);
        epd_waitUntilIdle();

        PRINTF("\r\n write image successed, starting update image\r\n");

        epd_writeCommand(0x04);
        Delay_ms(10);
        epd_writeData(0x00);
        epd_waitUntilIdle();

        epd_writeCommand(0x12);
        Delay_ms(10);
        epd_writeData(0x00);
        epd_waitUntilIdle();
        PRINTF("\r\n update image successed\r\n");
    }
}
